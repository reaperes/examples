<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>cardinal spline</title>
  <style>
    body {
      padding: 50px;
      overflow-y: hidden;
    }
  </style>
</head>
<body>
<div class="cardinal-curve"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.6.0/d3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
<script>
  // d3 chart example
  // https://github.com/reaperes/examples/blob/master/d3/index.html

  const object = {
    result: 0,
    sentence: ' glue the sheet to the dark blue background <sil>',
    stress: ['Glue', 'the', 'sheet', 'to', 'the', 'dark', 'blue', '\u02caack\u02cbround'],
    comment: 'glue \ubc1c\uc131\ud560 \ub54c, l \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nthe \ubc1c\uc131\ud560 \ub54c, \u00f0 \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nthe \ubc1c\uc131\ud560 \ub54c, \u00f0 \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nblue \ubc1c\uc131\ud560 \ub54c, l \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nblue \ubc1c\uc131\ud560 \ub54c, b \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nbackground \ubc1c\uc131\ud560 \ub54c, r \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nbackground \ubc1c\uc131\ud560 \ub54c, b \ubc1c\uc74c\uc5d0 \uc720\uc758\ud558\uc138\uc694.\nbackground \ub2e8\uc5b4\uc758 1\ubc88\uc9f8 \uc74c\uc5d0 \uccab\uc9f8 \uac15\uc138\uac00, 5\ubc88\uc9f8 \uc74c\uc5d0 \ub458\uc9f8 \uac15\uc138\uac00 \uc788\uc2b5\ub2c8\ub2e4.\n1',
    acute: [0, 0, 0, 0, 0, 0, 0, 1],
    grave: [0, 0, 0, 0, 0, 0, 0, 5],
    intonation: '2.4007675501735|2.5115974118299|2.570691783028|2.4817042389557|2.4121257282424|2.806080274117|3.7359417200446|4.2096891673761|3.449054689846|2.4330440814958|2.2863890000537|2.0994235691477|2.8356333242164|7.3290911946182|15.445431610698|28.493779617134|44.207930328044|56.630428843261|63.613597591583|68.241723650798|75.945147594227|88.470778809932|97.757496286757|98.412440758617|95.631281509678|94.765412323296|96.41618266914|98.878079216406|100|97.858871771367|91.033220125768|77.947093665255|58.857279758371|40.40637501022|29.170923621225|23.999379012353|24.296858114409|32.389184177118|46.041559385872|59.559360693843|67.127442404868|65.290478808602|54.733090280533|39.382194377745|27.758756132816|27.270935435321|29.2381582289|29.614200693872|31.250009851312|32.184739160804|32.764227506358|33.535138686087|30.771596177074|24.56971527168|18.426807379723|19.658487913284|35.160082137552|53.155729085906|63.82633740086|67.670609081991|68.076964574279|65.682541847927|60.603830691396|53.542651576083|45.352391094983|36.889253920437|27.71723966633|17.556987380746|9.1169614994928|4.5201206977635|2.856603919861|2.4705858578404|2.1694520685304|1.990673242871|2.2143687230232|2.3149947919909|2.522900374215|3.1052741815904|3.8895558929501|4.7978880378557|7.7740975560824|11.551811883555|12.579112503139|13.502061609436|21.23733369293|31.322036457989|36.821368873102|34.245228394728|26.233119958279|20.056266842978|17.388015367621|15.938593308331|15.8836405512|19.47825370654|28.81376880544|40.049776564957|47.369642471981|47.287911914097|39.120102016913|27.51376467302|19.184479454648|14.079914133355|9.6660734665358|6.0290651546865|5.8694861556874|14.349938892044|32.745382668935|55.309551941992|70.210177369239|73.92647058731|72.794776956031|72.568842896711|75.119029668869|78.333925406167|79.808659870783|79.873038767803|80.158599180548|80.343352773677|78.415158457425|73.561403913099|65.841563801485|54.450272939908|40.008287587746|25.804773885085|14.601588356394|8.5447614600241|6.0534083213758|5.0681563693972|6.0750530153333|6.8857292645679|6.3496533428677|4.6795055389371|3.6779008246917|5.2468656054189|11.859051356411|24.55274751213|38.699013130559|47.342355545048|49.215300759934|49.169974338306|50.751637339974|52.716934680394|53.223099023992|52.179501259129|50.466115561791|49.18129123686|47.774921449967|45.29498393048|42.101735933397|38.587815675094|33.903939760977|26.89056657436|19.233130911123|13.126530386607|8.0881663535128|4.190346969255|2.7954391520534|4.6505049922553|9.4787265056525|17.866933388882|33.254483312185|48.70235617845|55.699332532403|55.917816086147|55.106125232762|55.296824918419|54.2875212189|49.865486905785|42.461944448285|33.06739812873|22.261273762327|11.473608106623|4.0220738075596|2.0622918700368|2.3147284360562|2.6040540039047|2.9559703525415|3.3903924858032|4.2223096449267|5.7438104073569|6.2466921083281|5.0553361340162|4.6553255567561|6.4706824734303|12.645909617269|22.431075926019|31.521001386095|38.027683336142|42.24253468656|44.299627070591|44.704391650729|43.161862213125|39.527575503669|34.809676057345|30.587918660461|26.999140874423|23.823197202659|21.186050124694|19.520910421585|19.00421710195|18.194916447411|17.072612984653|16.371937376801|15.56682662041|14.635249256361|14.728209338129|15.146069648354|15.034880857392|14.809826308943|14.264283259697|13.039172024423|10.701632542895|7.4713678018507|5.6091884596262|6.6320856147505|7.1039506943024|5.8701615673564|4.4647804640694|5.0350066203687|5.9101698266523|4.9488007647367|3.367829099181|2.6263345811576|2.446808437577|2.5721723367733|2.6859630687865|2.5494710295087|2.8707805238618|3.8251634245835|4.052751163534|3.5493604640694|3.0154358198316|2.5124645552636|2.6770104667749|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|1.00000|',
    pitch: '0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|73.504173013829|72.384272753395|73.601082207968|76.654666200385|81.991697427163|84.927185833849|87.89092597155|90.219938837098|92.623396082434|94.783620562688|97.316724764841|99.269656075591|99.964061046201|100|99.517383215455|98.074018251705|95.246348631752|91.920011347157|90.33160572767|91.024081512132|94.032741010078|99.02834286998|97.082471764426|96.110177990141|95.635267681734|93.957650359347|89.286149847025|84.519659700035|0|0|0|0|0|0|0|0|0|0|0|0|96.231480542999|88.998634365964|84.760326634704|79.914902225592|77.47357619853|75.278689903677|73.562576781978|72.457434217977|70.578306150303|67.77244929775|64.815778991921|48.462619300445|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|80.288412815749|76.718201629359|72.167347772276|69.469314840683|66.373372184207|63.806258214404|61.108865777747|60.340011934898|61.326426761352|64.664961046195|68.44824269208|68.007984571594|67.56579726496|66.630084222966|65.393375784456|56.142138173998|55.175622331481|52.623270550561|52.571926987608|0|0|0|0|0|75.260720105889|75.458391732235|75.848589846752|76.412075213795|76.786232074894|76.471756762922|75.818427541164|75.368538250842|75.072679649379|74.767835507244|74.682477042412|75.249811155074|75.339018365525|74.178683492952|71.736716329176|0|0|0|0|0|0|0|0|0|0|0|0|0|77.432500449678|74.35838082906|71.872130307527|71.046164596635|71.526211058317|70.822821188812|71.37924635066|71.149488366805|70.535305707751|69.833845666173|68.335288393851|67.193564455781|66.083290872733|65.100082371628|64.174642277963|61.111431608159|55.082566375411|53.159154949979|0|0|0|0|0|0|0|0|68.360318396835|67.807747114835|67.751913669549|67.843045573698|67.929045175244|67.461186087133|65.148218967454|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|61.729463012833|60.132076986901|58.741984772252|57.618872410463|56.970033071038|56.601012363214|55.087056257744|54.135939248375|53.492877840718|52.705417555816|51.656749573816|51.405814825046|51.475128185788|50.047813460355|50.107495009482|49.950904266217|49.17627698405|49.118519486843|48.921488997212|49.051130178022|49.302706705284|49.322600554993|48.826508989221|48.968342677831|48.851538992205|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|0.00000|',
    nLocation: '19 35 59 81 92 112 139 184',
    startPoint: '10 29 42 76 87 97 128 150',
    cutPoint: 5,
    endPoint: '29 42 76 87 97 128 150 219',
    criWords: ',0,0,0,0,0,0,0,0'
  };

  function getArrayFromRawDataString(dataString) {
    const result = dataString.split(' ');
    result.shift();
    return result.map(Number);
  }

  const startPoints = getArrayFromRawDataString(object.startPoint);
  const endPoints = getArrayFromRawDataString(object.endPoint);
  const startEndPoints = startPoints.concat(endPoints);
  const startEndUniqPoints = _.uniq(startEndPoints);

  var intonations = object.intonation.split('|').map(Number);
  var minIntonation = d3.min(intonations);
  var maxIntonation = d3.max(intonations);


  var svgWidth = window.innerWidth - 1000;
  var svgHeight = window.innerHeight - 500;


  var xLinearScale = d3.scaleLinear()
    .domain([0, intonations.length])
    .range([0, svgWidth]);


  var yLinearScale = d3.scaleLinear()
    .domain([minIntonation, maxIntonation])
    .range([svgHeight, 0]);


  var svg = d3.select('.cardinal-curve')
    .append('svg')
    .attr('width', svgWidth)
    .attr('height', svgHeight);


  var cardinalCurveLine = d3.line()
    .x((v, idx) => xLinearScale(idx))
    .y(v => yLinearScale(v))
    .curve(d3.curveCatmullRomOpen);  // https://github.com/d3/d3-shape/blob/master/README.md#curves


  var j = 0;
  var partInto = [];

  /* 	for(var i=0; i< intonations.length; i++){


   svg.append('path')
   .datum(intonations)
   .attr('d', cardinalCurveLine)
   .attr('fill', 'none')
   .attr('stroke', function(){
   if(intonations[i] > 40 ){
   return 'red';
   }else{
   return 'blue';
   }
   });
   } */

  //for(var i=0; i <= intonations.length; i++){

  partInto[i] = intonations[i];

  if (i == startEndPoints[j]) {
    svg.append('path')
      .datum(partInto)
      .attr('d', cardinalCurveLine)
      .attr('fill', 'none')
      .attr('stroke', function () {
        switch (j % 2) {
          case 1:
            return 'red';
          case 2:
            return 'blue';
        }
      });

    j++;
    partInto = [];
  }

  //}


  /* svg.append('path')
   .datum(intonations)
   .attr('d', cardinalCurveLine)
   .attr('fill', 'none')
   .attr('stroke', function(){
   if(intonations[i] > 40 ){
   return 'red';
   }else{
   return 'blue';
   }
   }); */

</script>
</body>
</html>